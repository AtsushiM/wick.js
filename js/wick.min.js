/* wick.js v0.1 (c) 2013 Atsushi Mizoue. */!function(){var f=!0,g=!1,h,l,m,n,p,q,r,s,t,u,v,w,x,y,Storage,z,A,B,C,D,E,F,G,H,I,J,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,aa={}.hasOwnProperty;W="undefined"===typeof module?window:module.exports;W.Wick={};W=W.Wick;Z=window;x={};F=g;E=/0/.test(function(){0})?/\b_super\b/:/.*/;m=function(){};$=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"?f:g};R=function(a){return $("Number",a)};T=function(a){return $("String",a)};O=function(a){return $("Array",a)};Q=function(a){return $("Function",a)};
S=function(a){return $("Object",a)};P=function(a){return void 0===a?g:f};X=function(a,b){return function(){return b.apply(a,arguments)}};Y=function(a){var b;b=[];b.push.apply(b,a);return b};G=function(a){return O(a)?a.slice(0):a};H=function(a,b){a.splice(b,1)};U=function(a){return JSON.parse(a)};V=function(a){return JSON.stringify(a)};B=function(a,b){var c,d,e;for(c in b)if(e=b[c],d=c.match(/^on(.+)$/))a.on(d[1],e)};N=function(a){return!(!Q(a)||!a.length)};I=function(a){a.emit("complete")};J=function(a){a.emit("nexttask")};
M=function(a){a.emit("start")};L=function(a){a.emit("progress")};m.extend=function(a){var b,c,d;b=this;m=function(){!F&&this.init&&this.init.apply(this,arguments)};c=function(c){var d,k;d=a[c];k=b.prototype[c];Q(d)&&Q(k)&&E.test(d)?m.prototype[c]=function(){var a,b;b=this._super;this._super=k;a=d.apply(this,arguments);this._super=b;return a}:m.prototype[c]=d};F=f;m.prototype=new b;F=g;m.prototype.constructor=m;for(d in a)aa.call(a,d)&&c(d);m.extend=b.extend;return m};
C=function(a,b,c){a=a||m;a=a.extend(b);P(c)&&(a.support=c);return a};D=function(a,b){return C(n,a,b)};t=function(a,b){delete a[b].g;H(a,b)};p=function(){var a,b,c;a=Y(arguments||[]);b=a[2];a=a.slice(0,2);c=this.only.apply(this,a);if(g!==c&&!(c||{}).o)(c=this.g)&&c.bubble.apply(c,a);r(b)};r=function(a){Q(a)&&a.apply(this)};s=function(){this.n=f};u=function(){this.o=f};
q=function(a,b){var c;c=b[0];T(c)&&(c={type:c,arguments:b,n:g,o:g,preventDefault:s,stopPropagation:u});c.before=c.target;c.target=a;return c};
n=m.extend({init:function(){this.k={};return this.h=[]},dispose:function(){var a,b;this.removeChild;for(a in this)(b=this[a])&&b.dispose&&b.dispose;this.__proto__=null;for(a in this)this[a]=null,delete this[a]},on:function(a,b){var c;c=this.k;c[a]||(c[a]=[]);c[a].push(b)},one:function(a,b){var c,d=this;c=function(){b.apply(d,arguments);d.off(a,c)};c.t=b;this.on(a,c)},off:function(a,b){var c,d,e,K,k;d=this.k;if(b){if(e=d[a])for(c=k=e.length-1;0<=k;c=k+=-1)if(K=e[c],b===K||b===K.t)return H(e,c),0===
e.length&&delete d[a],f;return g}return delete d[a]},emit:p,bubble:p,capture:function(){var a,b,c,d,e;a=Y(arguments);b=a[2];c=this.h;a=a.slice(0,2);if(g!==this.only.apply(this,a))for(e=c.length-1;0<=e;e+=-1)d=c[e],d.capture.apply(d,a);r(b)},only:function(){var a,b,c,d,e;a=Y(arguments);b=q(this,a);c=this.k[b.type]||[];a[0]=b;for(e=c.length-1;0<=e;e+=-1)if(d=c[e])if(d=d.apply(this,a),d===g||b.n)return d;r(a[2]);return b},addChild:function(a){a.g&&a.g.removeChild(a);a.g=this;this.h.push(a)},removeChild:function(a){var b,
c,d;b=this.h;if(a)for(c=d=b.length-1;0<=d;c=d+=-1){if(b[c]===a){t(b,c);break}}else for(c=a=b.length-1;0<=a;c=a+=-1)t(b,c)}});
h=D({init:function(a){var b;this._super();a=a||x;b=G(a.queue||[]);B(this,a);this.resetQueue(b);this.done=X(this,this.done)},start:function(){M(this);this.paused=g;this.m()},restart:function(a){this.resetQueue(a);this.start()},stop:function(){this.a=null;this.emit("stop")},pause:function(){this.paused=f;this.emit("pause")},resume:function(){this.paused&&(this.emit("resume"),this.paused=g,this.m())},resetQueue:function(a){var b;a&&(this.s=G(a));a=this.a=G(this.s);for(b in a)a[b].resetQueue&&a[b].resetQueue();
this.emit("reset")},j:function(){this.emit("change",this.getQueue())},setQueue:function(a){this.a=G(a);this.j()},getQueue:function(){return G(this.a)},addTask:function(a,b){if(!R(b)||b>this.a.length)b=this.a.length;this.a.splice(b,0,a);this.j()},removeTask:function(a){var b,c,d;d=this.a;b=c=0;for(d=d.length;c<d;b=++c)if(this.a[b]===a){H(this.a,b);this.j();break}},m:function(){this.paused||this.exe()},exe:function(){var a,b,c=this;if(b=this.a.shift())return b.one&&b.start?(b.one("nexttask",this.done),
a=X(b,b.start)):a=N(b)?X(this,b):function(a){b.call(c);a()},a(this.done)}});l=C(h,{exe:function(){if(this.a){if(!this.a.length)return I(this),J(this);for(this.q=this.a.length;!this.paused&&this.a&&this.a[0];)this._super()}},done:function(){L(this);this.q--;this.q||(I(this),J(this))}});z=C(h,{exe:function(){if(this.a&&!this.paused){if(this.a[0])return this._super();I(this);J(this)}},done:function(){L(this);this.exe()}});
Storage=D({l:function(){return this.e?[]:{}},init:function(a){this.e=(a||x).array||g;this.reset()},set:function(a,b){var c;S(a)||(c={},c[a]=b,a=c);for(c in a)this.f[c]=a[c]},get:function(a){var b,c,d;d=this.l();b=this.f;if(a)return b[a];for(c in b)d[c]=b[c];return d},remove:function(a){P(this.f[a])&&(this.e?H(this.data,a):delete this.f[a])},reset:function(){return this.f=this.l()}});
A=D({init:function(a){a=a||x;this.e=a.array||g;this.c=a.namespace?a.namespace+"-":"";this.d=Z[a.type+"Storage"]},set:function(a,b){var c;S(a)||(c={},c[a]=b,a=c);for(c in a)this.d.setItem(this.c+c,V(a[c]))},get:function(a){var b,c,d;c=this.e?[]:{};d=this.d;if(a)return U(d.getItem(this.c+a));for(b in d)this.c?(a=b.split(this.c)[1])&&(c[a]=U(d[b])):c[b]=U(d[b]);return c},remove:function(a){a=this.c+a;P(this.d.getItem(a))&&this.d.removeItem(a)},reset:function(){var a;if(!this.c)return this.d.clear();
for(a in this.d)this.remove(a)}});v=C(A,{init:function(a){a=a||{};a.type="local";return this._super(a)}});y=C(A,{init:function(a){a=a||{};a.type="session";return this._super(a)}});
w=D({i:function(a,b,c){this.emit(a,this.b.get());b&&this.emit(a+":"+b,c)},init:function(a){var b,c,d;a=a||x;this._super();b=a.defaults||this.defaults||x;c=a.events||this.events;this.r=a.validate||this.validate||{};this.b=a.store||this.store||new Storage;for(d in b)this.set(d,b[d]);for(d in c)this.on(d,c[d])},set:function(a,b){var c;S(a)||(c={},c[a]=b,a=c);this.p=this.b.get();for(c in a){b=a[c];if(this.r[c]&&!this.r[c](c,b))return this.i("fail",c,b);this.b.set(c,b);this.emit("change:"+c,b)}this.emit("change",
this.b.get())},prev:function(a){return!a?this.p:this.p[a]},get:function(a){return this.b.get(a)},remove:function(a){var b,c;if(a)return b=this.b.get(a),c=this.b.remove(a),this.i("remove",a,b),c},reset:function(){this.b.reset();this.i("reset")}});W.Class=m;W.Composite=n;W.Storage=Storage;W.LocalStorage=v;W.SessionStorage=y;W.Model=w;W.Done=h;W.Serial=W.Sync=z;W.Parallel=W.Async=l;Z.read=read;}();
