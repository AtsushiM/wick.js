/* wick.js v0.1 (c) 2013 Atsushi Mizoue. */!function(){var g=!0,k=!1,l,m,n,p,q,r,s,t,u,v,w,x,y,z,Storage,A,B,C,D,E,F,aa,G,H,I,J,K,L,M,ba,N,O,ca,da,P,Q,ea,R,fa,S,ga,T,U,V,ha,W,X,ia,Y,Z,ja,$,ka={}.hasOwnProperty;T="undefined"===typeof module?window:module.exports;T.Wick={};T=T.Wick;Z=window;J=document;W={};ha=/[=,;:&\n\(\|]\s*read\(.+?,\s*['"](.+?)['"]\)/;ia="?"+1*new Date;y={};G=k;aa=/0/.test(function(){0})?/\b_super\b/:/.*/;n=function(){};$=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"?g:k};
ea=function(a){return $("Number",a)};fa=function(a){return $("String",a)};da=function(a){return $("Array",a)};Q=function(a){return $("Function",a)};R=function(a){return $("Object",a)};P=function(a){return void 0===a?k:g};U=function(a,b){return function(){return b.apply(a,arguments)}};Y=function(a){var b;b=[];b.push.apply(b,a);return b};H=function(a){return da(a)?a.slice(0):a};I=function(a,b){a.splice(b,1)};S=function(a){return JSON.parse(a)};ga=function(a){return JSON.stringify(a)};
C=function(a,b){var c,d,e;for(c in b)if(e=b[c],d=c.match(/^on(.+)$/))a.on(d[1],e)};ca=function(a){return!(!Q(a)||!a.length)};K=function(a){a.emit("complete")};L=function(a){a.emit("nexttask")};ba=function(a){a.emit("start")};M=function(a){a.emit("progress")};N=function(a){throw Error("not found "+a);};X=function(a){return a+ia};D=function(a){var b,c;a=a.split(".");c=Z;for(b in a)if(c=c[a[b]],!c)break;return c};
O=function(a,b){var c,d;c="";d=new XMLHttpRequest;d.onreadystatechange=function(){4===d.readyState&&(200===d.status?c="\n"+d.responseText:N(a),b&&b(c))};d.open("GET",X(a),!!b);d.send();return c};ja=function(a){J.head.appendChild(J.createElement("script")).text=O(a)};
n.extend=function(a){var b,c,d;b=this;n=function(){!G&&this.init&&this.init.apply(this,arguments)};c=function(c){var d,h;d=a[c];h=b.prototype[c];Q(d)&&Q(h)&&aa.test(d)?n.prototype[c]=function(){var a,b;b=this._super;this._super=h;a=d.apply(this,arguments);this._super=b;return a}:n.prototype[c]=d};G=g;n.prototype=new b;G=k;n.prototype.constructor=n;for(d in a)ka.call(a,d)&&c(d);n.extend=b.extend;return n};E=function(a,b,c){a=a||n;a=a.extend(b);P(c)&&(a.support=c);return a};
F=function(a,b){return E(p,a,b)};u=function(a,b){delete a[b].g;I(a,b)};q=function(){var a,b,c;a=Y(arguments||[]);b=a[2];a=a.slice(0,2);c=this.only.apply(this,a);if(k!==c&&!(c||{}).o)(c=this.g)&&c.bubble.apply(c,a);s(b)};s=function(a){Q(a)&&a.apply(this)};t=function(){this.n=g};v=function(){this.o=g};r=function(a,b){var c;c=b[0];fa(c)&&(c={type:c,arguments:b,n:k,o:k,preventDefault:t,stopPropagation:v});c.before=c.target;c.target=a;return c};
p=n.extend({init:function(){this.k={};return this.h=[]},dispose:function(){var a,b;this.removeChild;for(a in this)(b=this[a])&&b.dispose&&b.dispose;this.__proto__=null;for(a in this)this[a]=null,delete this[a]},on:function(a,b){var c;c=this.k;c[a]||(c[a]=[]);c[a].push(b)},one:function(a,b){var c,d=this;c=function(){b.apply(d,arguments);d.off(a,c)};c.t=b;this.on(a,c)},off:function(a,b){var c,d,e,f,h;d=this.k;if(b){if(e=d[a])for(c=h=e.length-1;0<=h;c=h+=-1)if(f=e[c],b===f||b===f.t)return I(e,c),0===
e.length&&delete d[a],g;return k}return delete d[a]},emit:q,bubble:q,capture:function(){var a,b,c,d,e;a=Y(arguments);b=a[2];c=this.h;a=a.slice(0,2);if(k!==this.only.apply(this,a))for(e=c.length-1;0<=e;e+=-1)d=c[e],d.capture.apply(d,a);s(b)},only:function(){var a,b,c,d,e;a=Y(arguments);b=r(this,a);c=this.k[b.type]||[];a[0]=b;for(e=c.length-1;0<=e;e+=-1)if(d=c[e])if(d=d.apply(this,a),d===k||b.n)return d;s(a[2]);return b},addChild:function(a){a.g&&a.g.removeChild(a);a.g=this;this.h.push(a)},removeChild:function(a){var b,
c,d;b=this.h;if(a)for(c=d=b.length-1;0<=d;c=d+=-1){if(b[c]===a){u(b,c);break}}else for(c=a=b.length-1;0<=a;c=a+=-1)u(b,c)}});
l=F({init:function(a){var b;this._super();a=a||y;b=H(a.queue||[]);C(this,a);this.resetQueue(b);this.done=U(this,this.done)},start:function(){ba(this);this.paused=k;this.m()},restart:function(a){this.resetQueue(a);this.start()},stop:function(){this.a=null;this.emit("stop")},pause:function(){this.paused=g;this.emit("pause")},resume:function(){this.paused&&(this.emit("resume"),this.paused=k,this.m())},resetQueue:function(a){var b;a&&(this.s=H(a));a=this.a=H(this.s);for(b in a)a[b].resetQueue&&a[b].resetQueue();
this.emit("reset")},j:function(){this.emit("change",this.getQueue())},setQueue:function(a){this.a=H(a);this.j()},getQueue:function(){return H(this.a)},addTask:function(a,b){if(!ea(b)||b>this.a.length)b=this.a.length;this.a.splice(b,0,a);this.j()},removeTask:function(a){var b,c,d;d=this.a;b=c=0;for(d=d.length;c<d;b=++c)if(this.a[b]===a){I(this.a,b);this.j();break}},m:function(){this.paused||this.exe()},exe:function(){var a,b,c=this;if(b=this.a.shift())return b.one&&b.start?(b.one("nexttask",this.done),
a=U(b,b.start)):a=ca(b)?U(this,b):function(a){b.call(c);a()},a(this.done)}});m=E(l,{exe:function(){if(this.a){if(!this.a.length)return K(this),L(this);for(this.q=this.a.length;!this.paused&&this.a&&this.a[0];)this._super()}},done:function(){M(this);this.q--;this.q||(K(this),L(this))}});A=E(l,{exe:function(){if(this.a&&!this.paused){if(this.a[0])return this._super();K(this);L(this)}},done:function(){M(this);this.exe()}});
V=function(a,b){var c;D(a)||(b&&!W[b]?(W[b+=".js"]=g,ja(b)):N(a));(c=D(a))||N(a);return c};V.ns=function(a,b){var c,d,e,f;a=a.split(".");c=0;d=a.length;for(f=Z;c<d;)e=f,f=f[a[c]]?f[a[c]]:f[a[c]]={},c++;if(b){for(c in f)void 0===b[c]&&(b[c]=f[c]);f=e[a[d-1]]=b}return f};
V.run=function(a){var b,c,d,e,f,h;f=[];d={};h="";b=function(a){f.unshift(a);W[a]||(W[a]=1,a.match(/^(\/\/|http)/)?(console.log(a),f.unshift(a),e()):(console.log(a),O(a,function(a){h=a+h;e()})))};e=function(){var a,d;(a=h.match(ha))?(d=a[1]+".js",h=h.slice(a.index+a[0].length),f.unshift(d),b(d)):c()};c=function(){var a,b,e;if(e=f.shift())d[e]?c():(d[e]=1,b=J.createElement("script"),a=function(){b.removeEventListener("load",a);c()},b.addEventListener("load",a),b.src=X(e),J.head.appendChild(b))};b(a+
".js")};Storage=F({l:function(){return this.e?[]:{}},init:function(a){this.e=(a||y).array||k;this.reset()},set:function(a,b){var c;R(a)||(c={},c[a]=b,a=c);for(c in a)this.f[c]=a[c]},get:function(a){var b,c,d;d=this.l();b=this.f;if(a)return b[a];for(c in b)d[c]=b[c];return d},remove:function(a){P(this.f[a])&&(this.e?I(this.data,a):delete this.f[a])},reset:function(){return this.f=this.l()}});
B=F({init:function(a){a=a||y;this.e=a.array||k;this.c=a.namespace?a.namespace+"-":"";this.d=Z[a.type+"Storage"]},set:function(a,b){var c;R(a)||(c={},c[a]=b,a=c);for(c in a)this.d.setItem(this.c+c,ga(a[c]))},get:function(a){var b,c,d;c=this.e?[]:{};d=this.d;if(a)return S(d.getItem(this.c+a));for(b in d)this.c?(a=b.split(this.c)[1])&&(c[a]=S(d[b])):c[b]=S(d[b]);return c},remove:function(a){a=this.c+a;P(this.d.getItem(a))&&this.d.removeItem(a)},reset:function(){var a;if(!this.c)return this.d.clear();
for(a in this.d)this.remove(a)}});w=E(B,{init:function(a){a=a||{};a.type="local";return this._super(a)}});z=E(B,{init:function(a){a=a||{};a.type="session";return this._super(a)}});
x=F({i:function(a,b,c){this.emit(a,this.b.get());b&&this.emit(a+":"+b,c)},init:function(a){var b,c,d;a=a||y;this._super();b=a.defaults||this.defaults||y;c=a.events||this.events;this.r=a.validate||this.validate||{};this.b=a.store||this.store||new Storage;for(d in b)this.set(d,b[d]);for(d in c)this.on(d,c[d])},set:function(a,b){var c;R(a)||(c={},c[a]=b,a=c);this.p=this.b.get();for(c in a){b=a[c];if(this.r[c]&&!this.r[c](c,b))return this.i("fail",c,b);this.b.set(c,b);this.emit("change:"+c,b)}this.emit("change",
this.b.get())},prev:function(a){return!a?this.p:this.p[a]},get:function(a){return this.b.get(a)},remove:function(a){var b,c;if(a)return b=this.b.get(a),c=this.b.remove(a),this.i("remove",a,b),c},reset:function(){this.b.reset();this.i("reset")}});T.Class=n;T.Composite=p;T.Storage=Storage;T.LocalStorage=w;T.SessionStorage=z;T.Model=x;T.Done=l;T.Serial=T.Sync=A;T.Parallel=T.Async=m;Z.read=V;}();
